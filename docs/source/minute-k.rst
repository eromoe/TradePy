日内K线
==================


"偷价"困局
-------------------

在 `快速上手 </quickstart.html>`_ 教程中提示到，使用日K回测时，如果日内价格运行区间同时包含止盈和止损价，此时TradePy **无法判断止盈止损的发生顺序**，因此会默认止损优先。如果您设置的止损与止盈幅度较小，这个问题会尤其突出，甚至完全改变收益曲线。


另一个问题是， **如果您希望以日内价格为买入**，比如"以开盘价计算当日60均线，价格回落到60均上方0.3%时买入"，用日K回测可能会发生"偷价"！让我们看一个简单例子:

- 假设某日开盘时全仓持股000001，在11:00触发止损
- 当日只有000333在10:00时，股价满足买入条件

此时，如果日K回测的实现逻辑是“先卖出，再买入”，则会在止损之后，再以000333在10:00时的价格买入。但实盘中000333在11:00后价格不一定再回归到10:00时位置，实际上当日是无法开新仓的。反之，如果是“先买入，再卖出”，并且000333在尾盘价格会回归到买入信号价，则会导致实际可开的仓位在回测时无法出现（因为卖出前没有可用资金）。 **解决这些问题的办法之一，即是使用分钟级K线回测**。

.. image:: _static/steal-price.jpeg
    :width: 500px



下载并导出分钟级K线
-------------------
TODO



使用分钟级K线回测
-------------------
TODO

